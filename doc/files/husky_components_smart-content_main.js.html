<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>husky_components/smart-content/main.js - husky</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="../assets/favicon.png">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="../assets/css/logo.png" title="husky"></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 0.1.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="../classes/AutoComplete.html">AutoComplete</a></li>
            
                <li><a href="../classes/AutoCompleteList.html">AutoCompleteList</a></li>
            
                <li><a href="../classes/CKEditor.html">CKEditor</a></li>
            
                <li><a href="../classes/Column-Options.html">Column-Options</a></li>
            
                <li><a href="../classes/ColumnNavigation.html">ColumnNavigation</a></li>
            
                <li><a href="../classes/DataGrid.html">DataGrid</a></li>
            
                <li><a href="../classes/Dependant Select.html">Dependant Select</a></li>
            
                <li><a href="../classes/Label.html">Label</a></li>
            
                <li><a href="../classes/Loader.html">Loader</a></li>
            
                <li><a href="../classes/Matcher.html">Matcher</a></li>
            
                <li><a href="../classes/Overlay.html">Overlay</a></li>
            
                <li><a href="../classes/Process.html">Process</a></li>
            
                <li><a href="../classes/Search.html">Search</a></li>
            
                <li><a href="../classes/Select.html">Select</a></li>
            
                <li><a href="../classes/SmartContent.html">SmartContent</a></li>
            
                <li><a href="../classes/Toggler.html">Toggler</a></li>
            
                <li><a href="../classes/Toolbar.html">Toolbar</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
                <li><a href="../modules/husky_components_auto-complete.html">husky/components/auto-complete</a></li>
            
                <li><a href="../modules/husky_components_auto-complete-list.html">husky/components/auto-complete-list</a></li>
            
                <li><a href="../modules/husky_components_column-navigation.html">husky/components/column-navigation</a></li>
            
                <li><a href="../modules/husky_components_column-options.html">husky/components/column-options</a></li>
            
                <li><a href="../modules/husky_components_label.html">husky/components/label</a></li>
            
                <li><a href="../modules/husky_components_matcher.html">husky/components/matcher</a></li>
            
                <li><a href="../modules/husky_components_process.html">husky/components/process</a></li>
            
                <li><a href="../modules/husky_components_smart-content.html">husky/components/smart-content</a></li>
            
                <li><a href="../modules/husky_components_toolbar.html">husky/components/toolbar</a></li>
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: husky_components/smart-content/main.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
/**
 * This file is part of Husky frontend development framework.
 *
 * (c) MASSIVE ART WebServices GmbH
 *
 * This source file is subject to the MIT license that is bundled
 * with this source code in the file LICENSE.
 *
 * @module husky/components/smart-content
 */

/**
 * @class SmartContent
 * @constructor
 *
 * @params {Object} [options] Configuration object
 * @params {Integer} [options.visibleItems] maximum of items visible at the start and in the view-less state
 * @params {String} [options.dataSource] default value for the data-source
 * @params {Boolean} [options.includeSubFolders] if true sub folders are included right from the beginning
 * @params {Array} [options.categories] array of categories with id and name property
 * @params {Integer} [options.preSelectedCategory] array with id of the preselected category
 * @params {Array} [options.tags] array of tags which are inserted at the beginning
 * @params {String} [options.tagsAutoCompleteUrl] url to which the tags input is sent and can be autocompleted
 * @params {String} [options.tagsGetParameter] parameter name for auto-completing tags
 * @params {Array} [options.sortBy] array of sort-possibilities with id and name property
 * @params {Integer} [options.preSelectedSortBy] array with id of the preselected sort-possibility
 * @params {String} [options.preSelectedSortMethod] Sort-method to begin with (asc or desc)
 * @params {Array} [options.presentAs] array of presentation-possibilities with id and name property
 * @params {Integer} [options.preSelectedPresentAs] array with id presentation-possibility to begin with
 * @params {Integer} [options.limitResult] maximum number of items returned on the request
 * @params {String} [options.instanceName] name of the component instance
 * @params {String} [options.url] url for requesting the items
 * @params {String} [options.dataSourceParameter] parameter for the source id
 * @params {String} [options.includeSubFoldersParameter] parameter for the include-sub-folders-value
 * @params {String} [options.categoryParameter] parameter for the category id
 * @params {String} [options.tagsParameter] parameter for the tags
 * @params {String} [options.sortByParameter] parameter for the sort-possibility id
 * @params {String} [options.sortMethodParameter] parameter for the sort method
 * @params {String} [options.presentAsParameter] parameter for the presentation-possibility id
 * @params {String} [options.limitResultParameter] parameter for the limit-result-value
 * @params {String} [options.resultKey] key for the data in the returning JSON-result
 * @params {Boolean} [options.subFoldersDisabled] if true sub-folders overlay-item will be disabled
 * @params {Boolean} [options.tagsDisabled] if true tags overlay-item will be disabled
 * @params {Boolean} [options.limitResultDisabled] if true limit-result overlay-item will be disabled
 *
 * @params {Object} [options.translations] object that gets merged with the default translation-keys
 * @params {String} [options.translations.noContentFound] translation key
 * @params {String} [options.translations.noContentSelected] translation key
 * @params {String} [options.translations.visible] translation key
 * @params {String} [options.translations.of] translation key
 * @params {String} [options.translations.configureSmartContent] translation key
 * @params {String} [options.translations.dataSource] translation key
 * @params {String} [options.translations.includeSubFolders] translation key
 * @params {String} [options.translations.filterByCategory] translation key
 * @params {String} [options.translations.filterByTags] translation key
 * @params {String} [options.translations.sortBy] translation key
 * @params {String} [options.translations.noSorting] translation key
 * @params {String} [options.translations.ascending] translation key
 * @params {String} [options.translations.descending] translation key
 * @params {String} [options.translations.presentAs] translation key
 * @params {String} [options.translations.limitResultTo] translation key
 * @params {String} [options.translations.noCategory] translation key
 * @params {String} [options.translations.choosePresentAs] translation key
 * @params {String} [options.translations.chooseDataSource] translation key
 * @params {String} [options.translations.from] translation key
 * @params {String} [options.translations.subFoldersInclusive] translation key
 * @params {String} [options.translations.viewAll] translation key
 * @params {String} [options.translations.viewLess] translation key
 * @params {Boolean} [options.translations.externalConfigs] if true component waits for external config object
 */
define([], function() {

    &#x27;use strict&#x27;;

    var defaults = {
            visibleItems: 5,
            dataSource: &#x27;&#x27;,
            subFoldersDisabled: false,
            categories: [],
            preSelectedCategory: null,
            tags: [],
            tagsDisabled: false,
            tagsAutoCompleteUrl: &#x27;&#x27;,
            tagsGetParameter: &#x27;search&#x27;,
            sortBy: [],
            preSelectedSortBy: null,
            preSelectedSortMethod: &#x27;asc&#x27;,
            presentAs: [],
            preSelectedPresentAs: null,
            limitResult: null,
            instanceName: &#x27;undefined&#x27;,
            url: &#x27;&#x27;,
            dataSourceParameter: &#x27;dataSource&#x27;,
            includeSubFolders: false,
            includeSubFoldersParameter: &#x27;includeSubFolders&#x27;,
            categoryParameter: &#x27;category&#x27;,
            tagsParameter: &#x27;tags&#x27;,
            sortByParameter: &#x27;sortBy&#x27;,
            sortMethodParameter: &#x27;sortMethod&#x27;,
            presentAsParameter: &#x27;presentAs&#x27;,
            limitResultParameter: &#x27;limitResult&#x27;,
            limitResultDisabled: false,
            resultKey: &#x27;_embedded&#x27;,
            translations: {},
            elementDataName: &#x27;smart-content&#x27;,
            externalConfigs: false
        },

        sortMethods = {
            asc: &#x27;Ascending&#x27;,
            desc: &#x27;Descanding&#x27;
        },

        constants = {
            containerSelector: &#x27;.smart-content-container&#x27;,
            headerSelector: &#x27;.smart-header&#x27;,
            contentSelector: &#x27;.smart-content&#x27;,
            sourceSelector: &#x27;.source&#x27;,
            footerClass: &#x27;smart-footer&#x27;,
            viewTogglerClass: &#x27;view-toggler&#x27;,
            buttonClass: &#x27;icon-adjust-alt&#x27;,
            includeSubSelector: &#x27;.includeSubCheck&#x27;,
            categoryDDClass: &#x27;category-dropdown&#x27;,
            tagListClass: &#x27;tag-list&#x27;,
            sortByDDClass: &#x27;sort-by-dropdown&#x27;,
            sortMethodDDClass: &#x27;sort-method-dropdown&#x27;,
            presentAsDDClass: &#x27;present-as-dropdown&#x27;,
            limitToSelector: &#x27;.limit-to&#x27;,
            dataSourceSelector: &#x27;.data-source&#x27;,
            contentListClass: &#x27;items-list&#x27;,
            loaderClass: &#x27;loader&#x27;
        },

        /** templates for component */
            templates = {
            skeleton: [
                &#x27;&lt;div class=&quot;smart-content-container form-element&quot;&gt;&#x27;,
                &#x27;&lt;div class=&quot;smart-header&quot;&gt;&lt;/div&gt;&#x27;,
                &#x27;&lt;div class=&quot;smart-content&quot;&gt;&lt;/div&gt;&#x27;,
                &#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;),
            source: [
                &#x27;&lt;div class=&quot;source&quot;&gt;&#x27;,
                &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= desc %&gt;&lt;/span&gt;&#x27;,
                &#x27;&lt;span class=&quot;val&quot;&gt;&lt;%= val %&gt;&lt;/span&gt;&#x27;,
                &#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;),
            noContent: [
                &#x27;&lt;div class=&quot;no-content&quot;&gt;&#x27;,
                &#x27;&lt;span class=&quot;icon-file&quot;&gt;&lt;/span&gt;&#x27;,
                &#x27;&lt;div class=&quot;text&quot;&gt;&lt;%= noContentStr %&gt;&lt;/div&gt;&#x27;,
                &#x27;&lt;/div&gt;&#x27;
            ].join(&#x27;&#x27;),
            contentItem: [
                &#x27;&lt;li data-id=&quot;&lt;%= dataId %&gt;&quot;&gt;&#x27;,
                &#x27;&lt;span class=&quot;num&quot;&gt;&lt;%= num %&gt;&lt;/span&gt;&#x27;,
                &#x27;&lt;span class=&quot;value&quot;&gt;&lt;%= value %&gt;&lt;/span&gt;&#x27;,
                &#x27;&lt;/li&gt;&#x27;
            ].join(&#x27;&#x27;),
            overlayContent: {
                main: [&#x27;&lt;div class=&quot;smart-overlay-content&quot;&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                dataSource: [&#x27;&lt;div class=&quot;item-half left&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= dataSourceStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;input type=&quot;text&quot; value=&quot;&lt;%= dataSourceValStr %&gt;&quot; class=&quot;data-source form-element&quot;/&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                subFolders: [&#x27;&lt;div class=&quot;item-half&quot;&gt;&#x27;,
                    &#x27;&lt;div class=&quot;check&lt;%= disabled %&gt;&quot;&gt;&#x27;,
                    &#x27;&lt;label&gt;&#x27;,
                    &#x27;&lt;div class=&quot;custom-checkbox&quot;&gt;&#x27;,
                        &#x27;&lt;input type=&quot;checkbox&quot; class=&quot;includeSubCheck form-element&quot;&lt;%= includeSubCheckedStr %&gt;/&gt;&#x27;,
                        &#x27;&lt;span class=&quot;icon&quot;&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;,
                    &#x27;&lt;span class=&quot;description&quot;&gt;&lt;%= includeSubStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;/label&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                categories: [&#x27;&lt;div class=&quot;item full&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= filterByCatStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;div class=&quot;&#x27; + constants.categoryDDClass + &#x27;&quot;&gt;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                tagList: [&#x27;&lt;div class=&quot;item full tags&lt;%= disabled %&gt;&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= filterByTagsStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;div class=&quot;&#x27; + constants.tagListClass + &#x27;&quot;&gt;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                sortBy: [&#x27;&lt;div class=&quot;item-half left&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= sortByStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;div class=&quot;&#x27; + constants.sortByDDClass + &#x27;&quot;&gt;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                sortMethod: [&#x27;&lt;div class=&quot;item-half&quot;&gt;&#x27;,
                    &#x27;&lt;div class=&quot;&#x27; + constants.sortMethodDDClass + &#x27; sortMethod&quot;&gt;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                presentAs: [&#x27;&lt;div class=&quot;item-half left&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= presentAsStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;div class=&quot;&#x27; + constants.presentAsDDClass + &#x27;&quot;&gt;&lt;/div&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;),

                limitResult: [&#x27;&lt;div class=&quot;item-half&quot;&gt;&#x27;,
                    &#x27;&lt;span class=&quot;desc&quot;&gt;&lt;%= limitResultToStr %&gt;&lt;/span&gt;&#x27;,
                    &#x27;&lt;input type=&quot;text&quot; value=&quot;&lt;%= limitResult %&gt;&quot; class=&quot;limit-to form-element&quot;&lt;%= disabled %&gt;/&gt;&#x27;,
                    &#x27;&lt;/div&gt;&#x27;].join(&#x27;&#x27;)
            }
        },

        /**
         * namespace for events
         * @type {string}
         */
            eventNamespace = &#x27;husky.smart-content.&#x27;,

        /**
         * raised after initialization process
         * @event husky.smart-content.initialize
         */
            INITIALIZED = function() {
            return createEventName.call(this, &#x27;initialize&#x27;);
        },

        /**
         * raised when all overlay components returned their value
         * @event husky.smart-content.input-retrieved
         */
            INPUT_RETRIEVED = function() {
            return createEventName.call(this, &#x27;input-retrieved&#x27;);
        },

        /**
         * raised before data is requested with AJAX
         * @event husky.smart-content.data-request
         */
            DATA_REQUEST = function() {
            return createEventName.call(this, &#x27;data-request&#x27;);
        },

        /**
         * raised when data has returned from the ajax request
         * @event husky.smart-content.data-retrieved
         */
            DATA_RETRIEVED = function() {
            return createEventName.call(this, &#x27;data-retrieved&#x27;);
        },

        /**
         * raised when the overlay data has been changed
         * @event husky.smart-content.data-changed
         */
            DATA_CHANGED = function() {
            return createEventName.call(this, &#x27;data-changed&#x27;);
        },

        /**
         * takes an config-object and merges it with this.options, before the initialization of the component
         * (options.externalConfigs has to be true)
         * @event husky.smart-content.external-configs
         */
            EXTERNAL_CONFIGS = function() {
            return createEventName.call(this, &#x27;external-configs&#x27;);
        },

        /**
         * takes an config-object and merges it with this.options. Moreover destroys overlay, so
         * it uses the new configs
         * @event husky.smart-content.set-configs
         */
            SET_CONFIGS = function() {
            return createEventName.call(this, &#x27;set-configs&#x27;);
        },

        /** returns normalized event names */
            createEventName = function(postFix) {
            return eventNamespace + (this.options.instanceName ? this.options.instanceName + &#x27;.&#x27; : &#x27;&#x27;) + postFix;
        };

    return {

        /**
         * Initialize component
         */
        initialize: function() {
            this.sandbox.logger.log(&#x27;initialize&#x27;, this);

            //merge options with defaults
            this.options = this.sandbox.util.extend(true, {}, defaults, this.options);

            //if externalConfigs is true wait for configs to to get in otherwise start the component right ahead
            if (this.options.externalConfigs === true) {
                this.sandbox.on(EXTERNAL_CONFIGS.call(this), function(configs) {

                    //merge the passed components with the current ones
                    this.options = this.sandbox.util.extend(true, {}, this.options, configs);

                    this.createComponent();
                }.bind(this));
            } else {
                this.createComponent();
            }
        },

        /**
         * Creates the component
         */
        createComponent: function() {
            this.setVariables();
            this.render();
            this.renderStartContent();
            this.startOverlay();
            this.bindEvents();
            this.setURI();
            this.loadContent();

            this.setElementData(this.overlayData);

            this.sandbox.emit(INITIALIZED.call(this));
        },

        /**
         * Sets the objects properties default values
         */
        setVariables: function() {
            this.$container = null;
            this.$header = null;
            this.$content = null;
            this.$footer = null;
            this.$button = null;
            this.itemsVisible = this.options.visibleItems;
            this.items = [];
            this.URI = {
                str: &#x27;&#x27;,
                hasChanged: false
            };

            this.initOverlayData();

            this.translations = {
                noContentFound: &#x27;smart-content.nocontent-found&#x27;,
                noContentSelected: &#x27;smart-content.nocontent-selected&#x27;,
                visible: &#x27;smart-content.visible&#x27;,
                of: &#x27;smart-content.of&#x27;,
                configureSmartContent: &#x27;smart-content.configure-smart-content&#x27;,
                dataSource: &#x27;smart-content.data-source&#x27;,
                includeSubFolders: &#x27;smart-content.include-sub-folders&#x27;,
                filterByCategory: &#x27;smart-content.filter-by-category&#x27;,
                filterByTags: &#x27;smart-content.filter-by-tags&#x27;,
                sortBy: &#x27;smart-content.sort-by&#x27;,
                noSorting: &#x27;smart-content.no-sorting&#x27;,
                ascending: &#x27;smart-content.ascending&#x27;,
                descending: &#x27;smart-content.descending&#x27;,
                presentAs: &#x27;smart-content.present-as&#x27;,
                limitResultTo: &#x27;smart-content.limit-result-to&#x27;,
                noCategory: &#x27;smart-content.no-category&#x27;,
                choosePresentAs: &#x27;smart-content.choose-present-as&#x27;,
                from: &#x27;smart-content.from&#x27;,
                subFoldersInclusive: &#x27;smart-content.sub-folders-inclusive&#x27;,
                viewAll: &#x27;smart-content.view-all&#x27;,
                viewLess: &#x27;smart-content.view-less&#x27;
            };

            this.translations = this.sandbox.util.extend(true, {}, this.translations, this.options.translations);
        },

        /**
         * Sets the starting values of properties related to the overlay
         */
        initOverlayData: function() {
            this.$overlayContent = null;
            this.overlayData = {
                dataSource: this.options.dataSource,
                includeSubFolders: this.options.includeSubFolders,
                category: this.options.preSelectedCategory,
                tags: this.options.tags,
                sortBy: this.options.preSelectedSortBy,
                sortMethod: this.options.preSelectedSortMethod,
                presentAs: this.options.preSelectedPresentAs,
                limitResult: this.options.limitResult
            };

            this.overlayDisabled = {
                categories: (this.options.categories.length === 0),
                sortBy: (this.options.sortBy.length === 0),
                presentAs: (this.options.presentAs.length === 0),
                subFolders: (this.options.subFoldersDisabled),
                tags: this.options.tagsDisabled,
                limitResult: this.options.limitResultDisabled
            };
        },

        /**
         * Renders the main container and the header
         */
        render: function() {
            this.renderContainer();
            this.renderHeader();
        },

        /**
         * Inserts the skeleton-template and finds the main-container
         */
        renderContainer: function() {
            this.sandbox.dom.html(this.$el, templates.skeleton);
            this.$container = this.sandbox.dom.find(constants.containerSelector, this.$el);
        },

        /**
         * Finds the header-container and renders the config-button
         */
        renderHeader: function() {
            this.$header = this.sandbox.dom.find(constants.headerSelector, this.$el);
            if (!!this.$header.length) {
                this.renderButton();
            } else {
                this.sandbox.logger.log(&#x27;Error: no Header-container found!&#x27;);
            }
        },

        /**
         * Renders the source text and prepends it to the header
         */
        prependSource: function() {
            var desc;
            if (typeof(this.overlayData.dataSource) !== &#x27;undefined&#x27;) {
                desc = this.sandbox.translate(this.translations.from);
                if (this.overlayData.includeSubFolders !== false) {
                    desc += &#x27; (&#x27; + this.sandbox.translate(this.translations.subFoldersInclusive) + &#x27;):&#x27;;
                } else {
                    desc += &#x27;:&#x27;;
                }
                this.sandbox.dom.prepend(this.$header, _.template(templates.source)({
                    desc: desc,
                    val: this.overlayData.dataSource
                }));
            }
        },

        /**
         * Removes the source element from the header
         */
        removeSource: function() {
            this.sandbox.dom.remove(this.sandbox.dom.find(constants.sourceSelector, this.$header));
        },

        /**
         * Renders and appends the toggle-button
         */
        renderButton: function() {
            this.$button = this.sandbox.dom.createElement(&#x27;&lt;a href=&quot;#&quot;/&gt;&#x27;);
            this.sandbox.dom.addClass(this.$button, constants.buttonClass);
            this.sandbox.dom.append(this.$header, this.$button);
        },

        /**
         * initializes the content container
         */
        initContentContainer: function() {
            //if not already exists render content-container
            if (this.$content === null) {
                this.$content = this.sandbox.dom.find(constants.contentSelector, this.$el);
            }
        },

        /**
         * Renders the content decides whether the footer is rendered or not
         */
        renderContent: function() {
            this.initContentContainer();

            if (this.items.length !== 0) {

                var ul, i = -1, length = this.items.length;
                ul = this.sandbox.dom.createElement(&#x27;&lt;ul class=&quot;&#x27; + constants.contentListClass + &#x27;&quot;/&gt;&#x27;);

                //loop stops if no more items are left or if number of rendered items matches itemsVisible
                for (; ++i &lt; length &amp;&amp; i &lt; this.itemsVisible;) {
                    this.sandbox.dom.append(ul, _.template(templates.contentItem)({
                        dataId: this.items[i].id,
                        value: this.items[i].name,
                        num: (i + 1)
                    }));
                }

                this.sandbox.dom.html(this.$content, ul);
                this.renderFooter();
            } else {
                //render no-content-template and detach the footer
                this.sandbox.dom.html(this.$content, _.template(templates.noContent)({
                    noContentStr: this.sandbox.translate(this.translations.noContentSelected)
                }));
                this.detachFooter();
            }
        },

        /**
         * Renders the content at the beginning
         * (with no items and before any request)
         */
        renderStartContent: function() {
            this.initContentContainer();

            this.sandbox.dom.html(this.$content, _.template(templates.noContent)({
                noContentStr: this.sandbox.translate(this.translations.noContentSelected)
            }));
        },

        /**
         * Renders the footer and calls a method to bind the events for itself
         */
        renderFooter: function() {
            this.itemsVisible = (this.items.length &lt; this.itemsVisible) ? this.items.length : this.itemsVisible;

            if (this.$footer === null) {
                this.$footer = this.sandbox.dom.createElement(&#x27;&lt;div/&gt;&#x27;);
                this.sandbox.dom.addClass(this.$footer, constants.footerClass);
            }

            this.sandbox.dom.html(this.$footer, [
                &#x27;&lt;span&gt;&#x27;,
                &#x27;&lt;strong&gt;&#x27; + this.itemsVisible + &#x27; &lt;/strong&gt;&#x27;, this.sandbox.translate(this.translations.of) , &#x27; &#x27;,
                &#x27;&lt;strong&gt;&#x27; + this.items.length + &#x27; &lt;/strong&gt;&#x27;, this.sandbox.translate(this.translations.visible),
                &#x27;&lt;/span&gt;&#x27;
            ].join(&#x27;&#x27;));

            this.appendViewToggler();
            this.sandbox.dom.append(this.$container, this.$footer);
            this.bindFooterEvents();
        },

        /**
         * Appends the view-toggler to the footer
         */
        appendViewToggler: function() {
            if (this.itemsVisible &lt; this.items.length) {
                this.sandbox.dom.append(
                    this.$footer,
                    &#x27;&lt;span class=&quot;&#x27; + constants.viewTogglerClass + &#x27;&quot;&gt;(&#x27; + this.sandbox.translate(this.translations.viewAll) + &#x27;)&lt;/span&gt;&#x27;
                );
            } else if (this.items.length &gt; this.options.visibleItems) {
                this.sandbox.dom.append(
                    this.$footer,
                    &#x27;&lt;span class=&quot;&#x27; + constants.viewTogglerClass + &#x27;&quot;&gt;(&#x27; + this.sandbox.translate(this.translations.viewLess) + &#x27;)&lt;/span&gt;&#x27;
                );
            }
        },

        /**
         * Removes the footer
         */
        detachFooter: function() {
            if (this.$footer !== null) {
                this.sandbox.dom.remove(this.$footer);
            }
        },

        /**
         * Binds general events
         */
        bindEvents: function() {
            this.sandbox.on(DATA_RETRIEVED.call(this), function() {
                this.renderContent();
                this.removeSource();
                this.prependSource();
            }.bind(this));

            this.sandbox.on(INPUT_RETRIEVED.call(this), function() {
                this.setURI();
                this.loadContent();
            }.bind(this));

            this.sandbox.on(&#x27;husky.overlay.smart-content.&#x27; + this.options.instanceName + &#x27;.initialized&#x27;, function() {
                this.startOverlayComponents();
            }.bind(this));

            this.sandbox.on(SET_CONFIGS.call(this), function(configs) {
                //merge this.options with passed configs
                this.options = this.sandbox.util.extend(false, {}, this.options, configs);

                //reload the overlay
                this.sandbox.emit(&#x27;husky.overlay.smart-content.&#x27; + this.options.instanceName + &#x27;.remove&#x27;);
                this.initOverlayData();
                this.startOverlay();

                //reload the items
                this.setURI();
                this.loadContent();
            }.bind(this));
        },

        /**
         * Binds footer events
         */
        bindFooterEvents: function() {
            this.sandbox.dom.on(
                this.sandbox.dom.find(&#x27;.&#x27; + constants.viewTogglerClass, this.$footer),
                &#x27;click&#x27;,
                function() {
                    this.toggleView();
                }.bind(this)
            );
        },

        /**
         * Starts the loader component
         */
        startLoader: function() {
            this.detachFooter();

            var loaderContainer = this.sandbox.dom.createElement(&#x27;&lt;div class=&quot;&#x27; + constants.loaderClass + &#x27;&quot;/&gt;&#x27;);
            this.sandbox.dom.html(this.$content, loaderContainer);

            this.sandbox.start([
                {
                    name: &#x27;loader@husky&#x27;,
                    options: {
                        el: loaderContainer,
                        size: &#x27;100px&#x27;,
                        color: &#x27;#e4e4e4&#x27;
                    }
                }
            ]);
        },

        /**
         * Changes the itemsVisible property and calls the render content method
         * (more or less items are visible)
         */
        toggleView: function() {
            if (this.itemsVisible &lt; this.items.length) {
                this.itemsVisible = this.items.length;
            } else {
                this.itemsVisible = this.options.visibleItems;
            }
            this.renderContent();
        },

        /**
         * Starts the overlay component
         */
        startOverlay: function() {
            this.initOverlayContent();

            this.sandbox.start([
                {
                    name: &#x27;overlay@husky&#x27;,
                    options: {
                        triggerEl: this.$button,
                        container: this.$el,
                        data: this.$overlayContent,
                        title: this.sandbox.translate(this.translations.configureSmartContent),
                        instanceName: &#x27;smart-content.&#x27; + this.options.instanceName,
                        okCallback: function() {
                            this.itemsVisible = this.options.visibleItems;
                            this.getOverlayData();
                        }.bind(this)
                    }
                }
            ]);
        },

        /**
         * Loads the overlay content based on a template
         */
        initOverlayContent: function() {

            this.$overlayContent = this.sandbox.dom.createElement(_.template(templates.overlayContent.main)());

            this.$overlayContent.append(_.template(templates.overlayContent.dataSource)({
                dataSourceStr: this.sandbox.translate(this.translations.dataSource),
                dataSourceValStr: this.options.dataSource
            }));
            this.$overlayContent.append(_.template(templates.overlayContent.subFolders)({
                includeSubStr: this.sandbox.translate(this.translations.includeSubFolders),
                includeSubCheckedStr: (this.options.includeSubFolders) ? &#x27; checked&#x27; : &#x27;&#x27;,
                disabled: (this.overlayDisabled.subFolders) ? &#x27; disabled&#x27; : &#x27;&#x27;
            }));
            this.$overlayContent.append(&#x27;&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&#x27;);
            this.$overlayContent.append(_.template(templates.overlayContent.categories)({
                filterByCatStr: this.sandbox.translate(this.translations.filterByCategory)
            }));
            this.$overlayContent.append(_.template(templates.overlayContent.tagList)({
                filterByTagsStr: this.sandbox.translate(this.translations.filterByTags),
                disabled: (this.overlayDisabled.tags) ? &#x27; disabled&#x27; : &#x27;&#x27;
            }));
            this.$overlayContent.append(_.template(templates.overlayContent.sortBy)({
                sortByStr: this.sandbox.translate(this.translations.sortBy)
            }));
            this.$overlayContent.append(_.template(templates.overlayContent.sortMethod)({
                filterByTagsStr: this.sandbox.translate(this.translations.filterByTags)
            }));
            this.$overlayContent.append(&#x27;&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&#x27;);

            this.$overlayContent.append(_.template(templates.overlayContent.presentAs)({
                presentAsStr: this.sandbox.translate(this.translations.presentAs)
            }));
            this.$overlayContent.append(_.template(templates.overlayContent.limitResult)({
                limitResultToStr: this.sandbox.translate(this.translations.limitResultTo),
                limitResult: (this.options.limitResult &gt; 0) ? this.options.limitResult : &#x27;&#x27;,
                disabled: (this.overlayDisabled.limitResult) ? &#x27; disabled&#x27; : &#x27;&#x27;
            }));
            this.$overlayContent.append(&#x27;&lt;div class=&quot;clear&quot;&gt;&lt;/div&gt;&#x27;);
        },

        /**
         * Starts all husky-components used by the overlay
         */
        startOverlayComponents: function() {
            this.sandbox.start([
                {
                    name: &#x27;select@husky&#x27;,
                    options: {
                        el: this.sandbox.dom.find(&#x27;.&#x27; + constants.categoryDDClass, this.$overlayContent),
                        instanceName: this.options.instanceName + constants.categoryDDClass,
                        defaultLabel: this.sandbox.translate(this.translations.noCategory),
                        value: &#x27;name&#x27;,
                        data: this.options.categories,
                        preSelectedElements: [this.options.preSelectedCategory],
                        disabled: this.overlayDisabled.categories
                    }
                },
                {
                    name: &#x27;auto-complete-list@husky&#x27;,
                    options: {
                        el: this.sandbox.dom.find(&#x27;.&#x27; + constants.tagListClass, this.$overlayContent),
                        instanceName: this.options.instanceName + constants.tagListClass,
                        items: this.options.tags,
                        remoteUrl: this.options.tagsAutoCompleteUrl,
                        autocomplete: (this.options.tagsAutoCompleteUrl !== &#x27;&#x27;),
                        getParameter: this.options.tagsGetParameter,
                        noNewTags: true
                    }
                },
                {
                    name: &#x27;select@husky&#x27;,
                    options: {
                        el: this.sandbox.dom.find(&#x27;.&#x27; + constants.sortByDDClass, this.$overlayContent),
                        instanceName: this.options.instanceName + constants.sortByDDClass,
//                        deselectLabel: &#x27;No sorting&#x27;,
                        value: &#x27;name&#x27;,
                        data: this.options.sortBy,
                        preSelectedElements: [this.options.preSelectedSortBy],
                        disabled: this.overlayDisabled.sortBy
                    }
                },
                {
                    name: &#x27;select@husky&#x27;,
                    options: {
                        el: this.sandbox.dom.find(&#x27;.&#x27; + constants.sortMethodDDClass, this.$overlayContent),
                        instanceName: this.options.instanceName + constants.sortMethodDDClass,
                        defaultLabel: &#x27;Select sort method&#x27;,
                        value: &#x27;name&#x27;,
                        data: [
                            {id: sortMethods.asc, name: this.sandbox.translate(this.translations.ascending)},
                            {id: sortMethods.desc, name: this.sandbox.translate(this.translations.descending)}
                        ],
                        preSelectedElements: [sortMethods[this.options.preSelectedSortMethod]],
                        disabled: this.overlayDisabled.sortBy
                    }
                },
                {
                    name: &#x27;select@husky&#x27;,
                    options: {
                        el: this.sandbox.dom.find(&#x27;.&#x27; + constants.presentAsDDClass, this.$overlayContent),
                        instanceName: this.options.instanceName + constants.presentAsDDClass,
                        defaultLabel: this.sandbox.translate(this.translations.choosePresentAs),
                        value: &#x27;name&#x27;,
                        data: this.options.presentAs,
                        preSelectedElements: [this.options.preSelectedPresentAs],
                        disabled: this.overlayDisabled.presentAs
                    }
                }
            ]);
        },

        /**
         * Generates the URI for the request
         */
        setURI: function() {
            var delimiter = (this.options.url.indexOf(&#x27;?&#x27;) === -1) ? &#x27;?&#x27; : &#x27;&amp;&#x27;,
                newURI = [this.options.url,
                    delimiter, this.options.dataSourceParameter, &#x27;=&#x27;, this.overlayData.dataSource,
                    &#x27;&amp;&#x27;, this.options.includeSubFoldersParameter, &#x27;=&#x27;, this.overlayData.includeSubFolders,
                    &#x27;&amp;&#x27;, this.options.categoryParameter, &#x27;=&#x27;, this.overlayData.category,
                    &#x27;&amp;&#x27;, this.options.tagsParameter, &#x27;=&#x27;, this.overlayData.tags,
                    &#x27;&amp;&#x27;, this.options.sortByParameter, &#x27;=&#x27;, this.overlayData.sortBy,
                    &#x27;&amp;&#x27;, this.options.sortMethodParameter, &#x27;=&#x27;, this.overlayData.sortMethod,
                    &#x27;&amp;&#x27;, this.options.presentAsParameter, &#x27;=&#x27;, this.overlayData.presentAs,
                    &#x27;&amp;&#x27;, this.options.limitResultParameter, &#x27;=&#x27;, this.overlayData.limitResult].join(&#x27;&#x27;);
            if (newURI !== this.URI.str) {
                //emit data changed event only if old URI is not null (not at the startup)
                if (this.URI.str !== &#x27;&#x27;) {
                    this.sandbox.emit(DATA_CHANGED.call(this), this.sandbox.dom.data(this.$el, &#x27;smart-content&#x27;), this.$el);
                }
                this.URI.str = newURI;
                this.URI.hasChanged = true;
            } else {
                this.URI.hasChanged = false;
            }
        },

        /**
         * Requests the data for the content
         */
        loadContent: function() {
            //only request if URI has changed
            if (this.URI.hasChanged === true) {
                this.sandbox.emit(DATA_REQUEST.call(this));
                this.startLoader();
                this.sandbox.util.ajax({
                    url: this.URI.str,

                    success: function(data) {
                        this.items = data[this.options.resultKey];
                        this.sandbox.emit(DATA_RETRIEVED.call(this));
                    }.bind(this),

                    error: function(error) {
                        this.sandbox.logger.log(error);
                    }.bind(this)
                });
            }
        },

        /**
         * Gets the values of all user inputs of the overlay
         * event is emited on which the associeted component responses
         */
        getOverlayData: function() {
            var categoryDef, tagsDef, sortByDef, sortMethodDef, presentAsDef;
            categoryDef = tagsDef = sortByDef = sortMethodDef = presentAsDef = this.sandbox.data.deferred();

            //include sub folders
            this.overlayData.includeSubFolders = this.sandbox.dom.prop(
                this.sandbox.dom.find(constants.includeSubSelector, this.$overlayContent),
                &#x27;checked&#x27;);

            //limit result
            this.overlayData.limitResult = this.sandbox.dom.val(
                this.sandbox.dom.find(constants.limitToSelector, this.$overlayContent)
            );

            //data-source
            this.overlayData.dataSource = this.sandbox.dom.val(this.sandbox.dom.find(constants.dataSourceSelector, this.$overlayContent));

            //category
            this.sandbox.emit(&#x27;husky.select.&#x27; + this.options.instanceName + constants.categoryDDClass + &#x27;.getChecked&#x27;,
                function(category) {
                    this.overlayData.category = category;
                    categoryDef.resolve();
                }.bind(this));

            //tags
            this.sandbox.emit(&#x27;husky.auto-complete-list.&#x27; + this.options.instanceName + constants.tagListClass + &#x27;.getTags&#x27;,
                function(tags) {
                    this.overlayData.tags = tags;
                    tagsDef.resolve();
                }.bind(this));

            //sort by
            this.sandbox.emit(&#x27;husky.select.&#x27; + this.options.instanceName + constants.sortByDDClass + &#x27;.getChecked&#x27;,
                function(sortBy) {
                    this.overlayData.sortBy = sortBy;
                    sortByDef.resolve();
                }.bind(this));

            //sort method
            this.sandbox.emit(&#x27;husky.select.&#x27; + this.options.instanceName + constants.sortMethodDDClass + &#x27;.getChecked&#x27;,
                function(sortMethod) {
                    this.overlayData.sortMethod = (sortMethod[0] === sortMethods.asc) ? &#x27;asc&#x27; : &#x27;desc&#x27;;
                    sortMethodDef.resolve();
                }.bind(this));

            //present as
            this.sandbox.emit(&#x27;husky.select.&#x27; + this.options.instanceName + constants.presentAsDDClass + &#x27;.getChecked&#x27;,
                function(presentAs) {
                    this.overlayData.presentAs = presentAs;
                    presentAsDef.resolve();
                }.bind(this));

            this.sandbox.dom.when(categoryDef.promise(), tagsDef.promise(), sortByDef.promise(), sortMethodDef.promise(), presentAsDef.promise()).then(function() {
                this.setElementData(this.overlayData);
                this.sandbox.emit(INPUT_RETRIEVED.call(this));
            }.bind(this));
        },

        /**
         * Binds the tags to the element
         * @param newData {object} new data
         */
        setElementData: function(newData) {
            var data = this.sandbox.util.extend(true, {}, newData);
            this.sandbox.dom.data(this.$el, this.options.elementDataName, data);
        }
    };
});

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
